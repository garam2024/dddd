{% load static %}
안녕
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
       <!-- Latest compiled and minified CSS -->
       <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
       <!-- jQuery library -->
       <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
       <!-- Latest compiled JavaScript -->
       <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
       <!-- lodash -->
       <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
      
       
       <link rel="shortcut icon" href="{%static 'django_app/img/logo/gjac_favicon.ico' %}">
       <link rel="stylesheet" href="{%static 'django_app/css/commons.css' %}">
       <link rel="stylesheet" href="{%static 'django_app/css/admin_index.css' %}">

        <link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <script>
            $(function() {
                $("#datepicker1,#datepicker2").datepicker({
                     dateFormat: 'yy-mm-dd'
                });
            });
        </script>
</head>
<body>

  {% for message in messages %}


  <div id="adminAlert" style="display:none;">{{ message }}</div>

{% endfor %}



    <header class="header">
        <h1 class="logo">
            <a href="{% url 'main' %}"><img src="{% static 'django_app/img/logo/gjac_logo.png' %}" alt="로고"></a>
        </h1>
    </header>
    <main class="admin-page container">
        <nav class="col-lg-2 side-nav">

            <form method="post" action="{% url 'logout_module' %}">
                <input id="alertLogout" type="submit" value="로그아웃" class="button btn-default">
            </form>
            <button type="button" class="button btn-default">작업 현황</button>
            <button type="button" class="button btn-default">유저 권한 관리</button>
            <a href="{% url 'insert_work' %}" class="button btn-default">작업 등록</a>
        </nav>
        <section class="col-lg-10">
            <h3>프로젝트 진척도</h3>
            <div class="work-progress">
                <ul>
                    <li>전체 작업 수</li>
                    <li>{{ total_worklist_len }}</li>
                    <li>전체 완료 수</li>
                    <li>{{ task_complete_len }}</li>
                    <li>전체 진행율</li>
                    <li>{{ tatal_rate | floatformat:2 }}%</li>

                    <!-- <li>{{task_process|floatformat:2}}%</li> -->
                </ul>
                <ul>
                    <li>작업 대기 수</li>
                    <li>{{ task_ready_len }}</li>
                    <li>작업 진행 수</li>
                    <li>{{ task_working_len }}</li>
                    <li>작업 완료 수</li>
                    <li>{{ inspect1_ready_len }}</li>
                </ul>

                <ul>
                    <li>1차 검수 대기 수</li>
                    <li>{{ inspect1_ready_len }}</li>
                    <li>1차 검수 진행 수</li>
                    <li>{{ inspect1_working_len }}</li>
                    <li>1차 검수 완료 수</li>
                    <li>{{ inspect2_ready_len }}</li>
                </ul>


                <ul>
                    <li>2차 검수 대기 수</li>
                    <li>{{ inspect2_ready_len }}</li>
                    <li>2차 검수 진행 수</li>
                    <li>{{ inspect2_working_len }}</li>
                    <li>2차 검수 완료 수</li>
                    <li>{{ inspect3_ready_len }}</li>
                </ul>


                <ul>
                    <li>3차 검수 대기 수</li>
                    <li>{{ inspect3_ready_len }}</li>
                    <li>3차 검수 진행 수</li>
                    <li>{{ inspect3_working_len }}</li>
                    <li>3차 검수 완료 수</li>
                    <li>{{ task_complete_len }}</li>
                </ul>

            </div>
            <!--작업상태 dbinfo 딕셔너리 가져오기  -->
<!--              <script>-->
<!--                                var dbinfo-->
<!--                                $.ajax({-->
<!--                                    type:'POST',-->
<!--                                    url : '/get_statusDic',-->
<!--                                    async:false,-->
<!--                                    success : function(data){-->
<!--                                        dbinfo = data-->
<!--                                        console.log(dbinfo)-->
<!--                                    },-->
<!--                                    error:function(err){-->
<!--                                    alert('작업상태불러오기실패_새로고침을눌러주세요')-->
<!--                                    },-->
<!--                                    })-->
<!--                            </script>-->





            <div class="tab">
                <h3>작업 현황</h3>
                <div class="tab-table">
                    <form action = "{% url 'admin_index' %}" method="POST" name="searchForm">
                        {% csrf_token %}
                        <div class="searchCondition" name="searchCondition">
                            <div class="search">
                                <div class="condition">
<!--                                    작업자 이름 :-->
                                    <input id="workerNm" class="form-control" name="workerNm" type="text" placeholder="작업자 이름 입력"  autocomplete='off'>
                                </div>
                                <div class="condition">
<!--                                    작업 종류 :-->
                                    <select id="workType" name="workType" class="form-control">
                                        <option value="">작업종류</option>
                                        <option value="인터페이스">인터페이스</option>
                                        <option value="이상행동">이상행동</option>
                                    </select>
                                </div>
                                <div class="condition">
<!--                                    작업 상태 :-->
                                    <select id="workStatus" name="workStatus" class="form-control">
                                        <option value="">작업상태</option>
                                        <option value="{{dbinfostatus.status_work_deagi}}">작업대기</option>
                                        <option value="{{dbinfostatus.status_work_run}}">작업진행</option>
                                        <option value="{{dbinfostatus.status_1cha_inspect_deagi}}">1차 검수 대기</option>
                                        <option value="{{dbinfostatus.status_1cha_inspect_run}}">1차 검수 진행</option>
                                        <option value="{{dbinfostatus.status_2cha_inspect_deagi}}">2차 검수 대기</option>
                                        <option value="{{dbinfostatus.status_2cha_inspect_run}}">2차 검수 진행</option>
                                        <option value="{{dbinfostatus.status_3cha_inspect_deagi}}">3차 검수 대기</option>
                                        <option value="{{dbinfostatus.status_3cha_inspect_run}}">3차 검수 진행</option>
                                        <option value="{{dbinfostatus.status_complet}}">작업완료</option>
                                        <option value="{{dbinfostatus.status_1cha_companion_return}}">1차 검수 반려</option>
                                        <option value="{{dbinfostatus.status_2cha_companion_return}}">2차 검수 반려</option>
                                        <option value="{{dbinfostatus.status_3cha_companion_return}}">3차 검수 반려</option>
                                        <option value="{{dbinfostatus.status_1cha_companion_cansel}}">1차 검수 취소</option>
                                        <option value="{{dbinfostatus.status_2cha_companion_cansel}}">2차 검수 취소</option>
                                        <option value="{{dbinfostatus.status_3cha_companion_cansel}}">3차 검수 취소</option>
                                        <option value="{{dbinfostatus.status_job_cansel}}">작업취소</option>
                                    </select>
                                </div>
                                <div class="condition">
<!--                                    <div>등록 기간 :</div>-->
                                    <div class="date">
                                        <input type="text" id="datepicker1"  class="form-control" name="searchBgn" placeholder="시작일 선택"  autocomplete='off'>
                                        <input type="text" id="datepicker2" class="form-control" name="searchEnd" placeholder="종료일 선택"  autocomplete='off'>
                                    </div>
                                </div>
                               <div class="condition">
<!--                                    작업  :-->
                                    <select id="workGroup" name="workGroup" class="form-control">
                                        <option value="all">전체</option>
                                        <option value="gjac">광주 인공지능센터</option>
                                        <option value="tbit">으뜸정보기술</option>
                                        <option value="dtw">디투리소스</option>
                                    </select>
                                </div>
                            </div>
                            <div class="searchSubmit">
                                <button type="submit" class="btn btn-primary btn-lg">검색</button>
<!--                                <button type="button" class="btn btn-primary btn-lg">초기화</button>-->
                            </div>
                        </div>

                    </form>


                    <div class="admin-table">
                        <table class="table table-striped table-hover" id="table-tab-01">
                            <thead>
                            <tr>
                                <th data-number='0'>작업번호</th>
                                <th data-number='1'>작업종류</th>
                                <th data-number='2'>작업자 이름</th>
                                <!-- <th data-number='3'>작업자 이름</th> -->
                                <th data-number='3'>작업상태</th>
                                <th data-number='4'>소속</th>
                                <th data-number='5'>작업보기</th>

                                <th data-number='6'>등록일</th>
                                <!-- <th data-number='5'>작업확인</th> -->
                                <!-- <th data-number='6'>검수자 ID</th>
                                <th data-number='7'>검수자 이름</th>
                                <th data-number='8'>검수상태</th>
                                <th data-number='9'>검수확인</th> -->

                            </tr>
                            </thead>
                            <tbody class="workViewTable"><!-- class="success" danger info warning active-->
                            <!-- 동경 테스트함 -->
                            {% if all_task_list|length == 0 %}
                            <tr>
                                <td colspan="7">검색 결과가 없습니다. </td>
                            </tr>
                            {% else %}
                            {% for item in all_task_list %}
                            <tr>
                                <td>{{item.work_id}}</td>
                                <td><button type="button" data-search="product">{{item.str_type}}</button></td>

                                {% if item.work_status == dbinfostatus.status_work_run or item.work_status == dbinfostatus.status_1cha_companion_return %}
                                <td>{{item.worker_name1}}</td>
                                {% elif item.work_status == dbinfostatus.status_1cha_inspect_run or item.work_status == dbinfostatus.status_2cha_companion_return %}
                                <td>{{item.worker_name2}}</td>
                                {% elif item.work_status == dbinfostatus.status_2cha_inspect_run or item.work_status == dbinfostatus.status_3cha_companion_return %}
                                <td>{{item.worker_name3}}</td>
                                {% elif item.work_status == dbinfostatus.status_3cha_inspect_run or item.work_status == dbinfostatus.status_job_cansel %}
                                <td>{{item.worker_name4}}</td>
                                {% else %}
                                <td>-</td>
                                {% endif %}

                                <td>{{item.str_status}}</td>
                                <td>
                                     <script>
                                            (function(){
                                                var val = '{{item.group_id}}'
                                                if(val){
                                                    if(val === 'gjac'){
                                                        document.write('광주 인공지능센터')
                                                    }else if(val === 'dtw'){
                                                        document.write('디투리소스')
                                                    }else if(val === 'tbit'){
                                                        document.write('으뜸정보기술')
                                                    }else{
                                                        document.write('알 수 없는 값')
                                                    }
                                                }else{
                                                    document.write('소속 없음')
                                                }
                                            }())
                                    </script>
                                </td>

                              {% if item.work_status in workviewConfirm %}
                                <td></td>
                               {%  else %}
                                <td><button data-work="admin_work_view">작업보기</button></td>
                               {% endif %}
                                <td>{{item.reg_date|date:"Y-m-d"}}</td>
                                <input data-work="id" type="hidden" value="{{item.work_id}}">
                                <input data-work="type" type="hidden" value="{{item.work_type}}">
                                <input data-work="status" type="hidden" value="{{item.work_status}}">





                            </tr>
                            {% endfor %}
                            {% endif %}

                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- 목록이 없을 때 -->
                <div class="message hidden">목록이 없습니다.</div>

            </div>
            <div class="tab">


                <h3>유저 권한 관리</h3>
                <div class="tab-table">
                    <div class="admin-table">
                        <table class="table table-striped table-hover" id="table-tab-02">
                            <thead>
                            <tr>
                                <th data-number='0'>구분</th>
                                <th data-number='1'>작업자</th>
                                <th data-number='2'>아이디</th>
                                <th data-number='3'>연락처</th>
                                <th data-number='4'>소속</th>
                                <th data-number='5'>작업권한</th>
                                <th data-number='6'>검수권한</th>
                                <th data-number='7'>관리자권한</th>
                                <th></th>
                            </tr>
                            </thead>







                            <tbody id="inputChangeCheck"><!-- class="success" danger info warning active-->
                            <!-- checkbox 권한이 있을 경우 checked를 해주세요. -->

                            {% for user in user_list %}
                            <tr>
                                <form action = "{% url 'admin_index' %}" method="post" name="userAuthForm">
                                    {%  csrf_token%}

                                    <td>{{ forloop.counter }}</td>
                                    <td><input name="user_name" id="user_name" value="{{user.user_name}}" hidden>{{user.user_name}}</td>
                                    <!-- <td><input type="text" name="worker" value="땡땡땡" class="hidden">asdf</td> -->
                                    <td><input name="user_account_id" id ="user_account_id" value  = "{{user.account_id}}" hidden>{{user.account_id}} </td>
                                    <td id = "user_phone_number", name = "user_phone_number">{{user.phone_number}}</td>

                                    <td id = "user_group", name = "user_group">
                                        <script>
                                            (function(){
                                                var val = '{{user.group_id}}'
                                                if(val){
                                                    if(val === 'gjac'){
                                                        document.write('광주 인공지능센터')
                                                    }else if(val === 'dtw'){
                                                        document.write('디투리소스')
                                                    }else if(val === 'tbit'){
                                                        document.write('으뜸정보기술')
                                                    }else{
                                                        document.write('알 수 없는 값')
                                                    }
                                                }else{
                                                    document.write('소속 없음')
                                                }
                                            }())
                                            </script>
                                    </td>


                                    {# 작업자 권한 #}

                                    {% if user.is_staff == True %}
                                    <td><input id = "workAuth" type="checkbox" name="workAuth" checked = "checked"></td>
                                    {% elif user.is_staff == False %}
                                    <td><input id = "workAuth" type="checkbox" name="workAuth"></td>
                                    {% endif %}


                                    {# 검수자 권한 #}

                                    {% if user.is_inspector == True %}
                                    <td><input id = "inpsectAuth" type="checkbox" name="inspectAuth" checked = "checked"></td>
                                    {% elif user.is_inspector == False %}
                                    <td><input id = "inpsectAuth" type="checkbox" name="inspectAuth"></td>
                                    {% endif %}


                                    {# 관리자 권한 #}

                                    {% if user.is_superuser == True %}
                                    <td><input id = "adminAuth" type="checkbox" name="adminAuth" checked = "checked" disabled = "disabled"></td>
                                    {% elif user.is_superuser == False %}
                                    <td>
                                        <input id = "adminAuth" type="checkbox" name="adminAuth" disabled = "disabled">
                                    </td>
                                    {% endif %}



                                    <td><button type="button" class="button-first save-value">저장</button></td>
                                </form>
                            </tr>
                            {% endfor %}

                            </tbody>

                        </table>
                    </div>
                </div>
            </div>
            <!-- 목록이 없을 때 -->
            <div class="message hidden">목록이 없습니다.</div>
            <!-- 목록이 없을 때-->



        </section>
        </div>
    </main>
    <footer class="container-fluid footer">
        <div class="container">
            <p>광주인공지능센터</p>
            <p>주소: 광주 동구 동계천로 150 / 문화전당역4번 출구에서 683m</p>
            <p><span class="glyphicon glyphicon-earphone"></span> 062-223-1335</p>
        </div>
    </footer>
    <div class="modal-background">
        <div class="modal-inner">
            <h4>반려 사유를 작성해 주세요.</h4>
            <textarea></textarea>
            <div class="button-form">
                <button type="button" id="fix-submit">확인</button>
                <button type="button" id="fix-cancel">취소</button>
            </div>
        </div>
    </div>
    <form style="display:none" id="admin_view" name="admin_view" method="post">
                 {% csrf_token %}
        <input name="worker_id" value="">
        <input name="work_id" value="">
        <input name="work_type" value="">
        <input name="work_status" value="">
    </form>>
    <script>

        const modal = document.querySelector('.modal-background')
        const modal_teatArea = modal.querySelector('textarea')
        let formEl
        let textAreaEl
        let textData

        function fix(e){
            modal.classList.add('active')
            modal_teatArea.value = ''
            modal_teatArea.focus()

            formEl = undefined
            textAreaEl = undefined
            textData = ''

            formEl = e.currentTarget.parentNode
            textAreaEl = formEl.querySelector('textarea')
        }

        const fixSubmit = document.querySelector('#fix-submit')
        const fixCancel = document.querySelector('#fix-cancel')

        fixSubmit.addEventListener('click', e => {
            if(textAreaEl){
                textAreaEl.value = modal_teatArea.value
            }
            modal.classList.remove('active')

            formEl.submit()
        })

        fixCancel.addEventListener('click', e => {
            formEl = undefined
            textAreaEl = undefined
            textData = ''

            modal.classList.remove('active')
        })

    </script>
    <script>
        $.ajaxSetup({
            headers: { "X-CSRFToken": '{{csrf_token}}' }
        });
    </script>
    <script src="{%static 'django_app/js/tool/admin_index.js' %}"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>

      let adminAlert = document.getElementById("adminAlert");
      var adminMessage = adminAlert? adminAlert.innerHTML : null;

    if(adminMessage){
      $().ready(function () {
        Swal.fire({
          icon: 'success', // Alert 타입
          title: adminMessage, // Alert 제목

        })
     })
    }

    </script>

     <script>


     let workViewTable = document.querySelector(".workViewTable");

     let workViewTr =  document.querySelectorAll(".workViewTable tr");

<!--     for (var i=0; i<workViewTr.length; i++){-->
<!--     workViewTr[i].addEventListener('click', function(e){-->
<!--      console.log("e.target",e.target)-->
<!--      console.log("work_status",e.target.parentNode.querySelector(".work_status"))-->
<!--      console.log("work_type",e.target.parentNode.querySelector(".work_type"))-->
<!--      console.log("work_id",e.target.parentNode.querySelector(".work_id"))-->
<!--     })-->


<!--     }-->





     workViewTable.addEventListener('click', function(e){

        workId = e.target.parentNode.parentNode.children[7].value
        workType = e.target.parentNode.parentNode.children[8].value
        workStatus = e.target.parentNode.parentNode.children[9].value



        console.log(workId,workType, workStatus)
        if (e.target.dataset.work =="admin_work_view"){
        //var pop= window.open("",'작업확인',"")

        var admin = document.forms.admin_view
        admin.action = '/admin/index/adminview'
        admin.target = "_new"
        admin.work_id.value = workId
        admin.work_type.value = workType
        admin.work_status.value = workStatus

        admin.submit()


}









     })






    </script>


</body>
</html>




